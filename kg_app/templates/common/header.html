{% load static %}

<header class="page-header row">
  <div class="logo-wrapper d-flex align-items-right col-auto"><a href="{% url 'kg_app:dashboard' %}"><img class="light-logo img-fluid"
        src="{% static 'assets/img/logo-3.png' %}" alt="logo"><img class="dark-logo img-fluid"
        src="{% static 'assets/img/logo-3.png' %}" alt="logo"></a><a class="close-btn toggle-sidebar"
      href="javascript:void(0)">
      <svg class="svg-color">
        <use href="{% static 'assets/svg/iconly-sprite.svg' %}#Category"></use>
      </svg></a></div>
  <div class="page-main-header col">
    <div class="header-left">
      <form class="form-inline search-full col" action="#" method="get">
        <div class="form-group w-100">
          <div class="Typeahead Typeahead--twitterUsers">
            <div class="u-posRelative">
              <input class="demo-input Typeahead-input form-control-plaintext w-100" type="text"
                placeholder="Search Admiro .." name="q" title="" autofocus="autofocus">
              <div class="spinner-border Typeahead-spinner" role="status"><span class="sr-only">Loading...</span>
              </div><i class="close-search" data-feather="x"></i>
            </div>
            <div class="Typeahead-menu"></div>
          </div>
        </div>
      </form>
    </div>
    <div class="nav-right">
      <ul class="header-right">
        <li class="search d-lg-none d-flex"> <a href="javascript:void(0)">
            <svg>
              <use href="{% static 'assets/svg/iconly-sprite.svg' %}#Search"></use>
            </svg></a></li>
        <li> <a class="dark-mode" href="javascript:void(0)">
            <svg>
              <use href="{% static 'assets/svg/iconly-sprite.svg' %}#moondark"></use>
            </svg></a></li>

        <li class="custom-dropdown">
          <a href="javascript:void(0)">
            <svg>
              <use href="{% static 'assets/svg/iconly-sprite.svg' %}#notification"></use>
            </svg>
          </a>
          <span class="badge rounded-pill badge-primary">{{ notification_count|default:0 }}</span>
          <div class="custom-menu notification-dropdown py-0 overflow-hidden">
            <h3 class="title bg-primary-light dropdown-title">Notification 
              <a href="{% url 'kg_app:feddback_history' %}" class="font-primary">
                  View all
              </a>
            </h3>
            <ul class="activity-timeline">
              {% for update in recent_updates %}
              <li class="d-flex align-items-start">
                <div class="activity-line"></div>
                <div class="activity-dot-primary"></div>
                <div class="flex-grow-1">
                  <h6 class="f-w-600 font-primary">
                    {{ update.updated_at|date:"d-m-Y" }}
                    <span>{{ update.updated_at|timesince }} ago</span>
                    <span class="circle-dot-primary float-end">
                      <svg class="circle-color">
                        <use href="{% static 'assets/svg/iconly-sprite.svg' %}#circle"></use>
                      </svg>
                    </span>
                  </h6>
                  <h5>{{ update.updated_by|default:"Admin"|capfirst  }} - Agreement: {{ update.agreement_id }}</h5>
                  <p class="mb-0">
                    Projection: {{ update.projection|default:"N/A" }} | 
                    Status: {{ update.location_status|default:"N/A" }}
                  </p>
                </div>
              </li>
              {% empty %}
              <li class="d-flex align-items-start">
                <div class="flex-grow-1 text-center py-3">
                  <p class="mb-0">No recent updates available</p>
                </div>
              </li>
              {% endfor %}
            </ul>
          </div>
        </li>

        <li class="profile-nav custom-dropdown">
          <div class="user-wrap">
            <div class="user-img"><img src="{% static 'assets/images/profile.png' %}" alt="user"></div>
            <div class="user-content">
              <h6>{{ request.session.admin_username }}</h6>
              <p class="mb-0">Admin<i class="fa-solid fa-chevron-down"></i></p>
            </div>
          </div>
          <div class="custom-menu overflow-hidden">
            <ul class="profile-body">
              <li class="d-flex">
                <svg class="svg-color">
                  <use href="{% static 'assets/svg/iconly-sprite.svg' %}#Login"></use>
                </svg><a class="ms-2" onclick="refreshAndLogout()">Log Out</a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </div>
  </div>
</header>

<script>
  function refreshAndLogout() {
    location.reload();
    window.location.href = "{% url 'kg_app:admin_logout' %}";
  }
</script>